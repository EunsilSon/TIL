# Spring Security

Spring 기반 애플리케이션의 보안(인증, 인가)을 담당하는 스프링 하위 프레임워크  
→ 개발자가 보안 관련 로직을 직접 작성하지 않아도 된다

<br>

## 인증과 인가

‘인증’과 ‘인가’는 Filter 흐름에 따라 처리한다.

Filter는 Dispatcher Servlet으로 가기 전에 적용되고, Interceptor는 Dispatcher와 Controller사이에 위치한다. 

- 인증: 본인 확인
- 인가: 접근 권한 여부

인증 성공 후 인가 절차가 진행된다.

Spring Security에서는 인증과 인가를 위해 **Credential 기반의 인증 방식**을 사용한다. 

- Principal (접근 주체): 보호 받는 리소스에 접근하는 대상의 아이디
- Credential (비밀번호): 리소스에 접근하는 대상의 비밀번호

<br>
<br>

# 전체적인 흐름

### 1. 보안 설정 추가

pom.xml 파일에서 의존성을 추가하고, 설정 클래스에서 Spring Security 활성화

### 2. 인증

- 사용자의 인증 정보 제공 및 확인
    1. 폼 기반 로그인 : 사용자가 아이디와 패스워드를 입력하는 가장 일반적인 방식이다.
    2. 소셜 로그인 : OAuth를 사용해 소셜 계정으로 로그인이 가능하다.
    3. 기본 인증 : HTTP 헤더에 사용자 이름과 비밀번호를 인코딩해 전송 후 서버는 이를 확인하여 인증한다.
    4. JWT 인증 : 토큰 기반의 인증으로, 클라이언트는 로그인 후에 JWT를 받아 이후의 요청에 포함시켜 서버에 전달하고, 서버는 이를 검증해 사용자를 인증한다.

### 3. 인가

- 인증 절차를 성공한 사용자가 리소스에 접근 가능한 지 결정
- 어노테이션을 사용해 컨트롤러 또는 메서드에 적용
- 역할 기반 및 접근 제어 목록(ACL) 기반의 인가 지원

### 4. 필터 체인

- 필터는 요청을 인터셉트(DispatcherServlet에 요청이 전달되기 전에 요청을 가로챔)해 보안 관련 작업을 수행
- 필터 체인은 `SecurityConfigurer`를 사용하여 구성

### 5. 사용자 세션 관리

- 로그인한 사용자의 상태 추적
- 로그인한 사용자의 유효성 유지, 세션 타임아웃, 세션 공유, 세션 제한

### 6. 보안 이벤트 처리

- 인증 실패, 로그인 성공, 권한 거부 등의 이벤트를 감지하고 처리

### 7. CSRF(Cross-Site Request Forgery) 방지

- CSRF  공격을 방지하기 위해 CSRF 토큰 검증 수행
- CsrfFilter는 요청에 CSRF 토큰이 포함되어 있는지 확인하고, 유효성을 검증

### 8. CORS(Cross-Origin Resource Sharing) 처리

- CORS를 허용 또는 거부해 다른 도메인에서의 요청 처리
- CorsFilter는 CORS 정책 적용 및 허용되는 도메인에 대한 요청 메서드 구성

<br>

>Spring Security는 DispatcherServlet에 요청이 도착하기 전에 보안 필터 체인(Security Filter Chain)을 이용하여 요청을 가로채 보안 작업을 수행한다. 이는 필터 체인이 요청을 인터셉트하여 보안 관련 작업을 처리하는 메커니즘을 의미한다.